<%= render "application/sidebar" %>

<h1><%= @collaborator.user.username %>'s Profile</h1>

<p><%= link_to "â† Back to Collaborators", project_collaborators_path(@project), class: "button" %></p>

<hr>

<div class="collaborator-details">
  <section class="profile-info">
    <h2>Profile Information</h2>
    <p><strong>Username:</strong> <%= @collaborator.user.username %></p>
    <p><strong>Email:</strong> <%= @collaborator.user.email_address %></p>
    <p><strong>Role:</strong> <%= @collaborator.role.titleize %></p>
    <p><strong>Joined Project:</strong> <%= @collaborator.created_at.strftime("%B %d, %Y") %></p>
  </section>

  <% unless @collaborator.invited? %>
    <section class="contribution-stats">
      <h2>Contribution Statistics</h2>
      <p><strong>Total Tasks:</strong> <%= @collaborator.task_count %></p>
      <p><strong>Completed Tasks:</strong> <%= @collaborator.completed_task_count %></p>
      <p><strong>Contribution Percentage:</strong> <%= @collaborator.contribution_percentage %>%</p>
    </section>

    <section class="tasks-by-status">
      <h2>Tasks by Status</h2>
      
      <% @tasks_by_status.each do |status, tasks| %>
        <div class="status-section">
          <h3><%= status %> (<%= tasks.count %>)</h3>
          <% if tasks.any? %>
            <ul>
              <% tasks.each do |task| %>
                <li>
                  <%= link_to task.title, project_task_path(@project, task) %>
                  <% if task.type.present? %>
                    <span class="task-type">[<%= task.type %>]</span>
                  <% end %>
                  <span class="task-date">- Updated: <%= task.updated_at.strftime("%b %d, %Y") %></span>
                </li>
              <% end %>
            </ul>
          <% else %>
            <p class="no-tasks">No tasks in this status</p>
          <% end %>
        </div>
      <% end %>
    </section>
  <% else %>
    <section class="invitation-pending">
      <h2>Invitation Status</h2>
      <p>This user has been invited but has not yet accepted the invitation.</p>
    </section>
  <% end %>

  <section class="actions">
    <% if @current_user_role == "manager" || @collaborator.user_id == Current.session&.user_id %>
      <%= link_to "Edit Collaborator", edit_project_collaborator_path(@project, @collaborator), class: "button" %>
    <% end %>
  </section>
</div>

<style>
  .collaborator-details {
    max-width: 800px;
  }
  
  .collaborator-details section {
    background: #f8f9fa;
    border: 1px solid #ddd;
    padding: 20px;
    margin: 20px 0;
    border-radius: 5px;
  }
  
  .collaborator-details h2 {
    margin-top: 0;
    border-bottom: 2px solid #333;
    padding-bottom: 10px;
  }
  
  .collaborator-details p {
    margin: 10px 0;
  }
  
  .status-section {
    margin: 15px 0;
  }
  
  .status-section h3 {
    color: #555;
  }
  
  .status-section ul {
    list-style: none;
    padding: 0;
  }
  
  .status-section li {
    padding: 8px 0;
    border-bottom: 1px solid #eee;
  }
  
  .task-type {
    color: #007bff;
    font-weight: bold;
  }
  
  .task-date {
    color: #666;
    font-size: 0.9em;
  }
  
  .no-tasks {
    color: #999;
    font-style: italic;
  }
  
  .invitation-pending {
    background: #fff3cd;
    border-color: #ffc107;
  }
  
  .button {
    padding: 10px 20px;
    background-color: #007bff;
    color: white;
    text-decoration: none;
    border-radius: 4px;
    display: inline-block;
  }
  
  .button:hover {
    background-color: #0056b3;
  }
</style>
