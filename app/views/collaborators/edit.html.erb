<div class="dashboard-layout">
  <%= render "application/sidebar" %>

  <div class="main-content">
    <div class="collaborator-page-container">
      <div class="collaborator-page-header">
        <div class="header-nav">
          <%= link_to project_collaborator_path(@project, @collaborator), class: "back-link" do %>
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="15 18 9 12 15 6"/>
            </svg>
            Back to Collaborator
          <% end %>
        </div>
      </div>

      <div class="collaborator-content-grid">
        <div class="collaborator-main-content">
          <div class="collaborator-profile-card">
            <div class="profile-card-header">
              <div class="profile-avatar-lg">
                <%= @collaborator.user.username[0].upcase %>
              </div>
              <div class="profile-header-info">
                <h1 class="profile-username">Edit <%= @collaborator.user.username %></h1>
                <span class="profile-role-badge role-<%= @collaborator.role %>"><%= @collaborator.role.titleize %></span>
              </div>
            </div>

            <div class="profile-info-grid">
              <div class="profile-info-item">
                <span class="profile-info-label">Username</span>
                <span class="profile-info-value"><%= @collaborator.user.username %></span>
              </div>
              <div class="profile-info-item">
                <span class="profile-info-label">Email</span>
                <span class="profile-info-value"><%= @collaborator.user.email_address %></span>
              </div>
              <div class="profile-info-item">
                <span class="profile-info-label">Current Role</span>
                <span class="profile-info-value"><%= @collaborator.role.titleize %></span>
              </div>
            </div>
          </div>

          <% if @current_user_role == "manager" && !@collaborator.invited? %>
            <section class="collaborator-edit-section">
              <h2 class="section-title">Change Role</h2>
              <%= form_with model: @collaborator, url: project_collaborator_path(@project, @collaborator), method: :patch, class: "collaborator-edit-form" do |form| %>
                <div class="form-group">
                  <%= form.label :role, "Select New Role", class: "form-label" %>
                  <%= form.select :role, 
                        options_for_select([
                          ["Manager", "manager"],
                          ["Developer", "developer"]
                        ], @collaborator.role),
                        {},
                        { class: "form-input" } %>
                </div>
                
                <div class="form-actions-inline">
                  <%= form.submit "Update Role", class: "btn btn-primary" %>
                </div>
              <% end %>
            </section>
          <% end %>

          <% if @current_user_role == "manager" %>
            <section class="collaborator-edit-section danger">
              <h2 class="section-title">Remove Collaborator</h2>
              <div class="collaborator-warning-banner">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                  <line x1="12" y1="9" x2="12" y2="13"/>
                  <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
                <p>Removing this collaborator will remove their access to the project. Their tasks will remain in the project but will be unassigned.</p>
              </div>
              
              <%= button_to "Remove #{@collaborator.user.username} from Project", 
                            project_collaborator_path(@project, @collaborator),
                            method: :delete,
                            data: { turbo_confirm: "Are you sure you want to remove #{@collaborator.user.username} from this project?" },
                            class: "btn btn-danger" %>
            </section>
          <% end %>

          <% if @collaborator.user_id == Current.session&.user_id && @current_user_role != "manager" %>
            <section class="collaborator-edit-section danger">
              <h2 class="section-title">Leave Project</h2>
              <div class="collaborator-warning-banner">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/>
                  <line x1="12" y1="9" x2="12" y2="13"/>
                  <line x1="12" y1="17" x2="12.01" y2="17"/>
                </svg>
                <p>If you leave this project, you will lose access to it and your tasks will be unassigned. A manager will need to re-invite you if you want to join again.</p>
              </div>
              
              <%= button_to "Leave Project", 
                            project_collaborator_path(@project, @collaborator),
                            method: :delete,
                            data: { turbo_confirm: "Are you sure you want to leave #{@project.name}?" },
                            class: "btn btn-danger" %>
            </section>
          <% end %>
        </div>
      </div>
    </div>
  </div>
</div>
