<div class="dashboard-layout">
  <%= render "application/sidebar" %>

  <div class="main-content">
    <% if flash[:created] %>
    <div class="notice"><%= flash[:created] %></div>
  <% end %>
  <% if flash[:notice] %>
    <div class="notice"><%= flash[:notice] %></div>
  <% end %>
  <% if flash[:alert] %>
    <div class="alert"><%= flash[:alert] %></div>
  <% end %>

  <!-- Header Section -->
  <header class="project-header">
    <div class="project-info">
      <h1 class="project-title"><%= @project.name %></h1>
      <p class="project-description"><%= @project.description %></p>
      
      <% if @project.repo.present? %>
        <p><strong>Repository:</strong> <%= link_to @project.repo, @project.repo, target: "_blank" %></p>
      <% end %>

      <div class="project-meta">
        <span class="meta-item"><strong>In Progress:</strong> <%= @project.tasks.where(status: "In Progress").count %></span>
      </div>
    </div>
  </header>

  <hr class="divider">

  <!-- Functionality Bar -->
  <div class="tasks-controls">
    <h2 class="section-title">Tasks</h2>
    
    <div class="controls-right">
      <!-- Filter Form -->
      <div class="filters">
        <%= form_with url: project_path(@project), method: :get, local: true do |form| %>
          <div>
            <%= form.label :filter, "Sort by" %>
            <%= form.select :filter, options_for_select([
              ["Date Created", "date_created"],
              ["Date Modified", "date_modified"]
            ], @current_filter), {}, { id: "filter" } %>
          </div>

          <div>
            <%= form.label :direction, "Order" %>
            <%= form.select :direction, options_for_select([
              ["Early → Late", "asc"],
              ["Late → Early", "desc"]
            ], @current_direction), {}, { id: "direction" } %>
          </div>
        <% end %>
      </div>

      <% if can_edit_project? %>
        <%= link_to new_project_task_path(@project), class: "btn btn-primary new-task-btn" do %>
          <span>+</span> New Task
        <% end %>
      <% end %>
    </div>
  </div>

  <!-- Task List Table -->
  <div class="task-list-container">
    <table class="task-table">
      <thead>
        <tr>
          <th>Status</th>
          <th>Task Name</th>
          <th>Assignee</th>
          <th class="text-right">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @tasks.each do |task| %>
          <tr class="task-row" onclick="window.location='<%= project_task_path(@project, task) %>';">
            <td>
              <span class="status-badge status-<%= task.status.to_s.parameterize %>"><%= task.status %></span>
            </td>
            <td>
              <div class="task-title-cell">
                <span class="task-title"><%= task.title %></span>
                <% if task.type.present? %>
                  <span class="task-type-badge"><%= task.type %></span>
                <% end %>
              </div>
            </td>
            <td>
              <% if task.user %>
                <div class="assignee-cell">
                  <span class="user-avatar-sm"><%= task.user.username[0].upcase %></span>
                  <span class="user-name"><%= task.user.username %></span>
                </div>
              <% else %>
                <span class="text-muted">-</span>
              <% end %>
            </td>
            <td class="text-right" onclick="event.stopPropagation();">
              <% if can_edit_project? %>
                <%= link_to "Edit", edit_project_task_path(@project, task), class: "btn-link" %>
              <% end %>
            </td>
          </tr>
        <% end %>
        
        <% if @tasks.empty? %>
          <tr>
            <td colspan="4" class="empty-table-state">
              No tasks found.
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>
  </div>
</div>
