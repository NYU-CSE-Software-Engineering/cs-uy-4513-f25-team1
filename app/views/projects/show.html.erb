<div class="dashboard-layout">
  <%= render "application/sidebar" %>

  <div class="main-content project-show-view">
    <% if flash[:created] %>
      <div class="alert alert-success"><%= flash[:created] %></div>
    <% end %>
    <% if flash[:notice] %>
      <div class="notice"><%= flash[:notice] %></div>
    <% end %>
    <% if flash[:alert] %>
      <div class="alert"><%= flash[:alert] %></div>
    <% end %>

    <!-- Header Section -->
    <header class="project-header">
      <div class="project-info">
        <h1 class="project-title"><%= @project.name %></h1>
        <p class="project-description"><%= @project.description %></p>
        
        <div class="project-meta">
           <span class="meta-item"><strong>WIP Limit:</strong> <%= @project.wip_limit || "None" %></span>
           <span class="meta-item"><strong>In Progress:</strong> <%= @project.tasks.where(status: "In Progress").count %></span>
        </div>
      </div>

      <!-- Collaborators Section (Commented out for later implementation)
      <div class="project-collaborators">
        <div class="collaborators-list">
          <%# @collaborators.each do |user| %>
            <%#= link_to "#", class: "collaborator-avatar", title: user.username do %>
              <%#= user.username[0..1].upcase %>
            <%# end %>
          <%# end %>
          
          <%# if can_edit_project? %>
            <%#= link_to new_project_collaborator_path(@project), class: "add-collaborator-btn", title: "Add Collaborator" do %>
              +
            <%# end %>
          <%# end %>
        </div>
        <%#= link_to "View All", project_collaborators_path(@project), class: "view-collaborators-link" %>
      </div>
      -->
    </header>

    <hr class="divider">

    <!-- Functionality Bar -->
    <div class="tasks-controls">
      <h2 class="section-title">Tasks</h2>
      
      <div class="controls-right">
        <!-- Placeholder for future filters if needed, currently just spacing -->
        
        <% if can_edit_project? %>
          <%= link_to new_project_task_path(@project), class: "btn btn-primary new-task-btn" do %>
            <span>+</span> New Task
          <% end %>
        <% end %>
      </div>
    </div>

    <!-- Task List Table -->
    <div class="task-list-container">
      <table class="task-table">
        <thead>
          <tr>
            <th>Status</th>
            <th>Task Name</th>
            <!-- Priority and Due Date columns removed as per user request -->
            <th>Assignee</th>
            <th class="text-right">Actions</th>
          </tr>
        </thead>
        <tbody>
          <% @tasks.each do |task| %>
            <tr class="task-row" onclick="window.location='<%= project_task_path(@project, task) %>';">
              <td>
                <span class="status-badge status-<%= task.status.to_s.parameterize %>"><%= task.status %></span>
              </td>
              <td>
                <div class="task-title-cell">
                   <span class="task-title"><%= task.title %></span>
                   <% if task.type.present? %>
                     <span class="task-type-badge"><%= task.type %></span>
                   <% end %>
                </div>
              </td>
              <!-- Assignee -->
              <td>
                <% if task.user %>
                  <div class="assignee-cell">
                    <span class="user-avatar-sm"><%= task.user.username[0].upcase %></span>
                    <span class="user-name"><%= task.user.username %></span>
                  </div>
                <% else %>
                  <span class="text-muted">-</span>
                <% end %>
              </td>
              <td class="text-right" onclick="event.stopPropagation();">
                <!-- Actions -->
                 <% if can_edit_project? %>
                    <%= link_to "Edit", edit_project_task_path(@project, task), class: "btn-link" %>
                 <% end %>
              </td>
            </tr>
          <% end %>
          
          <% if @tasks.empty? %>
            <tr>
              <td colspan="4" class="empty-table-state">
                No tasks found.
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    
  </div>
</div>
