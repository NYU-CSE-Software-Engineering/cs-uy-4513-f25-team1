<div class="task-detail-container">
  <div class="task-main">
    <div class="task-header">
      <div class="task-breadcrumbs">
        <%= link_to @project.name, project_path(@project) %> / Task #<%= @task.id %>
      </div>
      <div class="task-title-row">
        <span class="status-badge status-<%= @task.status %>"><%= @task.status.humanize %></span>
        <h1><%= @task.title %></h1>
      </div>
    </div>

    <div class="task-content">
      <% if @task.github_branch.present? %>
        <div class="github-branch-section">
          <strong>GitHub Branch:</strong>
          <%= link_to @task.github_branch, "https://github.com/#{@task.github_branch}", target: "_blank", class: "github-link" %>
        </div>
      <% end %>

      <div class="description-section">
        <h3>Description</h3>
        <% if @task.description.present? %>
          <div class="description-content">
            <%= simple_format(@task.description) %>
          </div>
        <% else %>
          <p class="text-muted">No description provided.</p>
        <% end %>
      </div>

      <div class="attachments-section">
        <h3>Attachments</h3>
        <% if @task.attachments.attached? %>
          <ul class="attachment-list">
            <% @task.attachments.each do |attachment| %>
              <li>
                <%= link_to attachment.filename, rails_blob_path(attachment, disposition: "attachment") %>
                <span class="text-muted">(<%= number_to_human_size(attachment.byte_size) %>)</span>
              </li>
            <% end %>
          </ul>
        <% else %>
          <p class="text-muted">No attachments.</p>
        <% end %>

        <div class="upload-form">
          <%= form_with model: [@project, @task], local: true do |f| %>
            <div class="form-group">
              <%= f.label :attachments, "Add Attachment" %>
              <%= f.file_field :attachments, multiple: true, class: "form-control" %>
            </div>
            <%= f.submit "Upload", class: "btn btn-sm btn-secondary" %>
          <% end %>
        </div>
      </div>
    </div>
    
    <div class="comments-section">
      <h3>Discussion</h3>
      <div class="comments-list">
        <% @comments.each do |comment| %>
          <div class="comment">
            <div class="comment-header">
              <strong><%= comment.user&.username || "User #{comment.user_id}" %></strong>
              <span class="text-muted"><%= time_ago_in_words(comment.created_at) %> ago</span>
            </div>
            <div class="comment-body">
              <%= simple_format(comment.body) %>
            </div>
          </div>
        <% end %>
      </div>

      <div class="new-comment-form">
        <%= form_with model: [@project, @task, @comment], local: true do |f| %>
          <div class="form-group">
            <%= f.text_area :body, rows: 3, class: "form-control", placeholder: "Add a comment..." %>
          </div>
          <%= f.submit "Comment", class: "btn btn-primary mt-2" %>
        <% end %>
      </div>
    </div>
  </div>

  <div class="task-sidebar">
    <div class="sidebar-section">
      <h4>Details</h4>
      <dl>
        <dt>Priority</dt>
        <dd><%= @task.priority %></dd>
        <dt>Assignee</dt>
        <dd><%= @task.user&.username || "Unassigned" %></dd>
        <dt>Created</dt>
        <dd><%= @task.created_at.strftime("%b %d, %Y") %></dd>
      </dl>
    </div>
    <div class="sidebar-actions">
      <%= link_to "Edit Task", edit_project_task_path(@project, @task), class: "btn btn-secondary" %>
    </div>
  </div>
</div>

<style>
  .task-detail-container {
    display: flex;
    gap: 30px;
  }
  .task-main {
    flex-grow: 1;
    max-width: 800px;
  }
  .task-sidebar {
    width: 250px;
    border-left: 1px solid #eee;
    padding-left: 20px;
  }
  
  .task-breadcrumbs {
    color: #586069;
    font-size: 14px;
    margin-bottom: 10px;
  }
  .task-title-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 20px;
  }
  .task-title-row h1 {
    margin: 0;
    font-size: 24px;
  }
  
  .github-branch-section {
    background: #f6f8fa;
    padding: 10px;
    border-radius: 6px;
    margin-bottom: 20px;
    border: 1px solid #e1e4e8;
  }
  
  .description-section, .attachments-section, .comments-section {
    margin-bottom: 30px;
    border-bottom: 1px solid #eee;
    padding-bottom: 20px;
  }
  
  .comment {
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 1px solid #f0f0f0;
  }
  .comment-header {
    font-size: 13px;
    margin-bottom: 5px;
  }
  
  .task-sidebar dt {
    font-weight: 600;
    font-size: 12px;
    color: #586069;
    margin-top: 10px;
  }
  .task-sidebar dd {
    margin: 0;
    font-size: 14px;
  }
  
  .btn-sm {
    padding: 4px 10px;
    font-size: 12px;
  }
</style>
